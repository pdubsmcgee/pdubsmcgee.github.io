---
import BaseLayout from '../layouts/BaseLayout.astro';

const requestAccessEndpoint = import.meta.env.PUBLIC_REQUEST_ACCESS_FORM_ENDPOINT ?? 'https://formsubmit.co/ajax/rumeryp12@gmail.com';
---
<BaseLayout title="Request Access | Foremost Machine, Inc." description="Request commercial account access for Foremost Machine, Inc.">
  <section class="section-shell">
    <h1 class="text-4xl font-bold text-white">Request Access</h1>
    <p class="mt-3 max-w-3xl text-slate-300">Complete this form for commercial account review. We manually approve qualified business customers and send access details by email.</p>

    <form id="request-access-form" method="POST" action={requestAccessEndpoint} class="card mt-8 space-y-4">
      <input type="hidden" name="_subject" value="New Foremost access request" />
      <input type="hidden" name="_template" value="table" />
      <input type="hidden" name="_captcha" value="false" />
      <div class="grid gap-4 md:grid-cols-2">
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Business legal name *</span><input required autocomplete="organization" name="business-legal-name" type="text" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Website *</span><input required autocomplete="url" name="website" type="url" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block md:col-span-2"><span class="mb-1 block text-sm text-slate-200">Business address *</span><input required autocomplete="street-address" name="business-address" type="text" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Contact name *</span><input required autocomplete="name" name="contact-name" type="text" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Title / role *</span><input required autocomplete="organization-title" name="title-role" type="text" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Email *</span><input required autocomplete="email" name="email" type="email" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block"><span class="mb-1 block text-sm text-slate-200">Phone *</span><input required autocomplete="tel" name="phone" type="tel" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" /></label>
        <label class="block md:col-span-2"><span class="mb-1 block text-sm text-slate-200">Intended order volume *</span>
          <select required name="intended-order-volume" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2">
            <option value="">Select one</option>
            <option>$1–5k/mo</option>
            <option>$5–25k/mo</option>
            <option>$25k+/mo</option>
            <option>Not sure yet</option>
          </select>
        </label>
        <label class="block md:col-span-2"><span class="mb-1 block text-sm text-slate-200">Typical parts/materials *</span><textarea required name="typical-parts-materials" rows="5" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2"></textarea></label>
      </div>
      <label class="flex items-start gap-3 text-sm text-slate-200">
        <input required type="checkbox" name="commercial-only-acknowledgement" class="mt-1" />
        <span>I acknowledge Foremost Machine, Inc. works exclusively with commercial accounts and may decline consumer/hobby requests.</span>
      </label>
      <p id="request-access-success" class="hidden rounded-md border border-emerald-400/50 bg-emerald-900/20 px-3 py-2 text-sm text-emerald-200">Thanks. Your request was received successfully.</p>
      <p id="request-access-error" class="hidden rounded-md border border-red-400/50 bg-red-900/20 px-3 py-2 text-sm text-red-200">We couldn’t submit your request right now. Please try again or call us directly.</p>
      <button type="submit" class="rounded-md bg-brand-500 px-5 py-3 font-semibold text-white hover:bg-brand-700">Submit Request</button>
    </form>
  </section>

  <script define:vars={{ requestAccessEndpoint }} is:inline>
    const requestForm = document.getElementById('request-access-form');
    const successNotice = document.getElementById('request-access-success');
    const errorNotice = document.getElementById('request-access-error');

    requestForm?.addEventListener('submit', async (event) => {
      if (!(requestForm instanceof HTMLFormElement) || !requestAccessEndpoint) {
        return;
      }

      event.preventDefault();
      successNotice?.classList.add('hidden');
      errorNotice?.classList.add('hidden');

      const body = new FormData(requestForm);

      try {
        const response = await fetch(requestAccessEndpoint, {
          method: 'POST',
          body,
          headers: { Accept: 'application/json' }
        });

        if (!response.ok) {
          throw new Error('Submission failed');
        }

        requestForm.reset();
        successNotice?.classList.remove('hidden');
      } catch {
        errorNotice?.classList.remove('hidden');
      }
    });
  </script>
</BaseLayout>
