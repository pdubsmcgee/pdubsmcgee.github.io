---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout title="Portal Login | Foremost Machine, Inc.">
  <section class="section-shell">
    <div class="card mx-auto max-w-lg">
      <h1 class="text-3xl font-semibold text-white">Portal Login</h1>
      <p class="mt-3 text-slate-300">Approved commercial customers can enter the shared portal password provided by email.</p>
      <form id="portal-login-form" class="mt-6 space-y-4">
        <label class="block">
          <span class="mb-1 block text-sm text-slate-200">Password</span>
          <input id="portal-password" required type="password" class="w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2" />
        </label>
        <p id="portal-error" class="hidden text-sm text-red-300">Invalid password. Please try again.</p>
        <button type="submit" class="rounded-md bg-brand-500 px-5 py-2 font-semibold text-white">Enter Portal</button>
      </form>
      <p class="mt-5 text-xs text-slate-400">Need access? Submit a commercial request through the Request Access form.</p>
    </div>
  </section>

  <script define:vars={{ portalPassword: import.meta.env.PUBLIC_PORTAL_PASSWORD }} is:inline>
    const form = document.getElementById('portal-login-form');
    const passwordInput = document.getElementById('portal-password');
    const errorEl = document.getElementById('portal-error');
    const sessionKey = 'foremost_portal_session';

    form?.addEventListener('submit', (event) => {
      event.preventDefault();
      if (!(passwordInput instanceof HTMLInputElement)) {
        return;
      }

      if (!portalPassword || passwordInput.value !== portalPassword) {
        errorEl?.classList.remove('hidden');
        return;
      }

      const session = {
        authenticated: true,
        timestamp: Date.now()
      };
      localStorage.setItem(sessionKey, JSON.stringify(session));
      window.location.href = '/portal';
    });
  </script>
</BaseLayout>
